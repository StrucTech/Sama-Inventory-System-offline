"""
ุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฌุฏูุฏุฉ
ูููู ุจูุณุญ ุฌููุน ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุดูุชุงุช ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ
"""

import os
import sys
import gspread
import datetime

# ุฅุถุงูุฉ ูุณุงุฑ ุงููุดุฑูุน
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from config.settings import load_config

def reset_and_populate_sheets():
    """ุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ"""
    
    print("๐๏ธ ูุณุญ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช...")
    print("=" * 60)
    
    # ุชุญููู ุงูุฅุนุฏุงุฏุงุช
    config = load_config()
    if not config:
        print("โ ูุดู ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช")
        return False
    
    credentials_file = config.get("credentials_file", "config/credentials.json")
    spreadsheet_name = config.get("spreadsheet_name", "Inventory Management")
    
    try:
        # ุงูุงุชุตุงู ุจู Google Sheets
        print("๐ ุงูุงุชุตุงู ุจู Google Sheets...")
        client = gspread.service_account(filename=credentials_file)
        spreadsheet = client.open(spreadsheet_name)
        
        # 1. ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุณุชุฎุฏููู
        print("\n1๏ธโฃ ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุณุชุฎุฏููู...")
        setup_users_sheet(spreadsheet)
        
        # 2. ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุดุงุฑูุน
        print("\n2๏ธโฃ ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุดุงุฑูุน...")
        setup_projects_sheet(spreadsheet)
        
        # 3. ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุฎุฒูู
        print("\n3๏ธโฃ ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุฎุฒูู...")
        setup_inventory_sheet(spreadsheet)
        
        # 4. ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุณุฌู ุงูุฃูุดุทุฉ
        print("\n4๏ธโฃ ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุณุฌู ุงูุฃูุดุทุฉ...")
        setup_activity_log_sheet(spreadsheet)
        
        print("\n" + "=" * 60)
        print("โ ุชู ุฅุนุงุฏุฉ ููููุฉ ุฌููุน ุงูุดูุชุงุช ุจูุฌุงุญ!")
        print("๐ ุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ")
        print("๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู")
        
        return True
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช: {e}")
        return False

def setup_users_sheet(spreadsheet):
    """ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุณุชุฎุฏููู ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ"""
    try:
        # ุญุฐู ุงูุดูุช ุฅุฐุง ูุงู ููุฌูุฏุงู
        try:
            old_sheet = spreadsheet.worksheet("Users")
            spreadsheet.del_worksheet(old_sheet)
            print("๐๏ธ ุชู ุญุฐู ุดูุช ุงููุณุชุฎุฏููู ุงููุฏูู")
        except:
            pass
        
        # ุฅูุดุงุก ุดูุช ุฌุฏูุฏ
        users_sheet = spreadsheet.add_worksheet(title="Users", rows=1000, cols=8)
        print("๐ ุชู ุฅูุดุงุก ุดูุช ุงููุณุชุฎุฏููู ุงูุฌุฏูุฏ")
        
        # ุฅุถุงูุฉ ุงูุนูุงููู
        headers = [
            "ุงุณู ุงููุณุชุฎุฏู",      # A
            "ูููุฉ ุงููุฑูุฑ",       # B  
            "ููุน ุงููุณุชุฎุฏู",      # C
            "ุฑูู ุงูุชุนุฑูู",       # D
            "ุฑูู ุงููุดุฑูุน",       # E
            "ุชุงุฑูุฎ ุงูุฅูุดุงุก",      # F
            "ุขุฎุฑ ุชุณุฌูู ุฏุฎูู",     # G
            "ุงูุญุงูุฉ"            # H
        ]
        
        users_sheet.update("A1:H1", [headers])
        
        # ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
        current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        test_users = [
            # [ุงุณู ุงููุณุชุฎุฏู, ูููุฉ ุงููุฑูุฑ, ููุน ุงููุณุชุฎุฏู, ุฑูู ุงูุชุนุฑูู, ุฑูู ุงููุดุฑูุน, ุชุงุฑูุฎ ุงูุฅูุดุงุก, ุขุฎุฑ ุชุณุฌูู ุฏุฎูู, ุงูุญุงูุฉ]
            ["admin", "admin123", "admin", "USR_001", "", current_time, "", "ูุดุท"],
            ["ahmed_manager", "ahmed123", "user", "USR_002", "PRJ_001", current_time, "", "ูุดุท"],
            ["sara_developer", "sara123", "user", "USR_003", "PRJ_001", current_time, "", "ูุดุท"],
            ["omar_engineer", "omar123", "user", "USR_004", "PRJ_002", current_time, "", "ูุดุท"],
            ["fatima_designer", "fatima123", "user", "USR_005", "PRJ_002", current_time, "", "ูุดุท"],
            ["khalid_analyst", "khalid123", "user", "USR_006", "PRJ_003", current_time, "", "ูุดุท"],
            ["mona_tester", "mona123", "user", "USR_007", "", current_time, "", "ูุดุท"]  # ุจุฏูู ูุดุฑูุน
        ]
        
        # ุฅุถุงูุฉ ุงูุจูุงูุงุช
        for i, user in enumerate(test_users, start=2):
            users_sheet.update(f"A{i}:H{i}", [user])
        
        print(f"โ ุชู ุฅุถุงูุฉ {len(test_users)} ูุณุชุฎุฏู ุชุฌุฑูุจู")
        print("๐ค ุงููุณุชุฎุฏููู: admin, ahmed_manager, sara_developer, omar_engineer, fatima_designer, khalid_analyst, mona_tester")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุฏุงุฏ ุดูุช ุงููุณุชุฎุฏููู: {e}")

def setup_projects_sheet(spreadsheet):
    """ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุดุงุฑูุน ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ"""
    try:
        # ุญุฐู ุงูุดูุช ุฅุฐุง ูุงู ููุฌูุฏุงู
        try:
            old_sheet = spreadsheet.worksheet("Projects")
            spreadsheet.del_worksheet(old_sheet)
            print("๐๏ธ ุชู ุญุฐู ุดูุช ุงููุดุงุฑูุน ุงููุฏูู")
        except:
            pass
        
        # ุฅูุดุงุก ุดูุช ุฌุฏูุฏ
        projects_sheet = spreadsheet.add_worksheet(title="Projects", rows=1000, cols=7)
        print("๐ ุชู ุฅูุดุงุก ุดูุช ุงููุดุงุฑูุน ุงูุฌุฏูุฏ")
        
        # ุฅุถุงูุฉ ุงูุนูุงููู
        headers = [
            "ุฑูู ุงููุดุฑูุน",       # A
            "ุงุณู ุงููุดุฑูุน",       # B
            "ุงููุตู",            # C
            "ุญุงูุฉ ุงููุดุฑูุน",      # D
            "ุชุงุฑูุฎ ุงูุฅูุดุงุก",      # E
            "ุชุงุฑูุฎ ุงูุจุฏุก",       # F
            "ุชุงุฑูุฎ ุงูุงูุชูุงุก"     # G
        ]
        
        projects_sheet.update("A1:G1", [headers])
        
        # ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
        current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        test_projects = [
            # [ุฑูู ุงููุดุฑูุน, ุงุณู ุงููุดุฑูุน, ุงููุตู, ุญุงูุฉ ุงููุดุฑูุน, ุชุงุฑูุฎ ุงูุฅูุดุงุก, ุชุงุฑูุฎ ุงูุจุฏุก, ุชุงุฑูุฎ ุงูุงูุชูุงุก]
            ["PRJ_001", "ูุดุฑูุน ุชุทููุฑ ุงูุชุทุจูู", "ุชุทููุฑ ุชุทุจูู ุฅุฏุงุฑุฉ ุงููุฎุฒูู ุงูุฌุฏูุฏ", "ูุดุท", current_time, "2025-01-01", "2025-12-31"],
            ["PRJ_002", "ูุดุฑูุน ุชุญุฏูุซ ุงููุธุงู", "ุชุญุฏูุซ ูุชุทููุฑ ุงูุฃูุธูุฉ ุงูุญุงููุฉ", "ูุดุท", current_time, "2025-02-01", "2025-11-30"],
            ["PRJ_003", "ูุดุฑูุน ุชุฏุฑูุจ ุงูููุธููู", "ุจุฑูุงูุฌ ุชุฏุฑูุจู ุดุงูู ููููุธููู ุงูุฌุฏุฏ", "ูุดุท", current_time, "2025-03-01", "2025-06-30"],
            ["PRJ_004", "ูุดุฑูุน ุฃุจุญุงุซ ุงูุณูู", "ุฏุฑุงุณุฉ ูุชุญููู ุงุญุชูุงุฌุงุช ุงูุณูู", "ูุนูู", current_time, "", ""],
            ["PRJ_005", "ูุดุฑูุน ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ", "ุตูุงูุฉ ุฏูุฑูุฉ ููุฃูุธูุฉ ูุงููุนุฏุงุช", "ููุชูู", current_time, "2024-01-01", "2024-12-31"]
        ]
        
        # ุฅุถุงูุฉ ุงูุจูุงูุงุช
        for i, project in enumerate(test_projects, start=2):
            projects_sheet.update(f"A{i}:G{i}", [project])
        
        print(f"โ ุชู ุฅุถุงูุฉ {len(test_projects)} ูุดุฑูุน ุชุฌุฑูุจู")
        print("๐ ุงููุดุงุฑูุน: ุชุทููุฑ ุงูุชุทุจููุ ุชุญุฏูุซ ุงููุธุงูุ ุชุฏุฑูุจ ุงูููุธูููุ ุฃุจุญุงุซ ุงูุณููุ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุฏุงุฏ ุดูุช ุงููุดุงุฑูุน: {e}")

def setup_inventory_sheet(spreadsheet):
    """ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุงููุฎุฒูู ูุน ุจูุงูุงุช ุชุฌุฑูุจูุฉ"""
    try:
        # ุญุฐู ุงูุดูุช ุฅุฐุง ูุงู ููุฌูุฏุงู
        try:
            old_sheet = spreadsheet.worksheet("Inventory")
            spreadsheet.del_worksheet(old_sheet)
            print("๐๏ธ ุชู ุญุฐู ุดูุช ุงููุฎุฒูู ุงููุฏูู")
        except:
            pass
        
        # ุฅูุดุงุก ุดูุช ุฌุฏูุฏ
        inventory_sheet = spreadsheet.add_worksheet(title="Inventory", rows=1000, cols=4)
        print("๐ ุชู ุฅูุดุงุก ุดูุช ุงููุฎุฒูู ุงูุฌุฏูุฏ")
        
        # ุฅุถุงูุฉ ุงูุนูุงููู
        headers = [
            "ุงุณู ุงูุนูุตุฑ",        # A
            "ุงููููุฉ ุงููุชุงุญุฉ",     # B
            "ุฑูู ุงููุดุฑูุน",       # C
            "ุขุฎุฑ ุชุญุฏูุซ"         # D
        ]
        
        inventory_sheet.update("A1:D1", [headers])
        
        # ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
        current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        test_inventory = [
            # [ุงุณู ุงูุนูุตุฑ, ุงููููุฉ ุงููุชุงุญุฉ, ุฑูู ุงููุดุฑูุน, ุขุฎุฑ ุชุญุฏูุซ]
            ["ุฃุฌูุฒุฉ ููุจููุชุฑ ูุญูููุฉ", 25, "PRJ_001", current_time],
            ["ุดุงุดุงุช ุงูุนุฑุถ", 15, "PRJ_001", current_time],
            ["ููุญุงุช ููุงุชูุญ", 30, "PRJ_001", current_time],
            ["ูุฃุฑุฉ ููุจููุชุฑ", 35, "PRJ_001", current_time],
            ["ูุงุจูุงุช HDMI", 20, "PRJ_001", current_time],
            
            ["ุฎูุงุฏู ุงูุดุจูุฉ", 5, "PRJ_002", current_time],
            ["ุฃุฌูุฒุฉ ุงูุชูุฌูู", 8, "PRJ_002", current_time],
            ["ูุงุจูุงุช ุงูุดุจูุฉ", 100, "PRJ_002", current_time],
            ["ูุญููุงุช ุงูุทุงูุฉ", 15, "PRJ_002", current_time],
            ["ุฃูุฑุงุต ุงูุชุฎุฒูู ุงูุตูุจุฉ", 12, "PRJ_002", current_time],
            
            ["ูุชุจ ุงูุชุฏุฑูุจ", 50, "PRJ_003", current_time],
            ["ุฏููู ุงููุณุชุฎุฏู", 75, "PRJ_003", current_time],
            ["ุฃููุงู ูุฃูุฑุงู", 200, "PRJ_003", current_time],
            ["ููุญุงุช ุงูุนุฑุถ", 10, "PRJ_003", current_time],
            ["ุฃุฌูุฒุฉ ุงูุนุฑุถ", 6, "PRJ_003", current_time],
            
            ["ุทุงุจุนุงุช ุงูููุฒุฑ", 8, "", current_time],  # ุจุฏูู ูุดุฑูุน
            ["ุฃูุฑุงู ุงูุทุจุงุนุฉ", 500, "", current_time],  # ุจุฏูู ูุดุฑูุน
            ["ุฎุฑุงุทูุด ุงูุญุจุฑ", 25, "", current_time]  # ุจุฏูู ูุดุฑูุน
        ]
        
        # ุฅุถุงูุฉ ุงูุจูุงูุงุช
        for i, item in enumerate(test_inventory, start=2):
            inventory_sheet.update(f"A{i}:D{i}", [item])
        
        print(f"โ ุชู ุฅุถุงูุฉ {len(test_inventory)} ุนูุตุฑ ุชุฌุฑูุจู")
        print("๐ฆ ุงูุนูุงุตุฑ: ุฃุฌูุฒุฉ ููุจููุชุฑุ ุดุงุดุงุชุ ุฎูุงุฏูุ ูุชุจ ุชุฏุฑูุจุ ุทุงุจุนุงุชุ ูุบูุฑูุง")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุฏุงุฏ ุดูุช ุงููุฎุฒูู: {e}")

def setup_activity_log_sheet(spreadsheet):
    """ุฅุนุงุฏุฉ ููููุฉ ุดูุช ุณุฌู ุงูุฃูุดุทุฉ"""
    try:
        # ุญุฐู ุงูุดูุช ุฅุฐุง ูุงู ููุฌูุฏุงู
        try:
            old_sheet = spreadsheet.worksheet("Activity_Log")
            spreadsheet.del_worksheet(old_sheet)
            print("๐๏ธ ุชู ุญุฐู ุดูุช ุณุฌู ุงูุฃูุดุทุฉ ุงููุฏูู")
        except:
            pass
        
        # ุฅูุดุงุก ุดูุช ุฌุฏูุฏ
        activity_sheet = spreadsheet.add_worksheet(title="Activity_Log", rows=1000, cols=6)
        print("๐ ุชู ุฅูุดุงุก ุดูุช ุณุฌู ุงูุฃูุดุทุฉ ุงูุฌุฏูุฏ")
        
        # ุฅุถุงูุฉ ุงูุนูุงููู
        headers = [
            "ุงูุชุงุฑูุฎ ูุงูููุช",     # A
            "ููุน ุงูุนูููุฉ",       # B
            "ุงุณู ุงูุนูุตุฑ",        # C
            "ุงููููุฉ",           # D
            "ุงุณู ุงููุณุชูู",       # E
            "ุงูุชูุงุตูู"          # F
        ]
        
        activity_sheet.update("A1:F1", [headers])
        
        # ุฅุถุงูุฉ ุณุฌู ุชุฌุฑูุจู
        current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        test_activities = [
            [current_time, "ุฅูุดุงุก", "ุฅุนุฏุงุฏ ุงููุธุงู", "1", "ุงููุฏูุฑ", "ุชู ุฅุนุฏุงุฏ ุงููุธุงู ูุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ"],
            [current_time, "ุฅุถุงูุฉ", "ุฃุฌูุฒุฉ ููุจููุชุฑ ูุญูููุฉ", "25", "", "ุฅุถุงูุฉ ุงูุฏูุนุฉ ุงูุฃููู ูู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ"],
            [current_time, "ุฅุถุงูุฉ", "ุฎูุงุฏู ุงูุดุจูุฉ", "5", "", "ุฅุถุงูุฉ ุฎูุงุฏู ุฌุฏูุฏุฉ ูููุดุฑูุน"]
        ]
        
        # ุฅุถุงูุฉ ุงูุจูุงูุงุช
        for i, activity in enumerate(test_activities, start=2):
            activity_sheet.update(f"A{i}:F{i}", [activity])
        
        print(f"โ ุชู ุฅุถุงูุฉ {len(test_activities)} ูุดุงุท ุชุฌุฑูุจู ูู ุงูุณุฌู")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุนุฏุงุฏ ุดูุช ุณุฌู ุงูุฃูุดุทุฉ: {e}")

if __name__ == "__main__":
    print("โ๏ธ ุชุญุฐูุฑ: ุณูุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ!")
    print("ูู ุชุฑูุฏ ุงููุชุงุจุนุฉุ (y/n): ", end="")
    
    confirm = input().lower().strip()
    if confirm in ['y', 'yes', 'ูุนู', 'ู']:
        success = reset_and_populate_sheets()
        if success:
            print("\n๐ ุชู ุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช ุจูุฌุงุญ!")
            print("\n๐ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงูุฌุฏูุฏุฉ:")
            print("=" * 40)
            
            print("\n๐ฅ ุงููุณุชุฎุฏููู:")
            print("   ๐ admin / admin123 (ูุฏูุฑ)")
            print("   ๐ค ahmed_manager / ahmed123 (ูุดุฑูุน ุชุทููุฑ ุงูุชุทุจูู)")
            print("   ๐ค sara_developer / sara123 (ูุดุฑูุน ุชุทููุฑ ุงูุชุทุจูู)")
            print("   ๐ค omar_engineer / omar123 (ูุดุฑูุน ุชุญุฏูุซ ุงููุธุงู)")
            print("   ๐ค fatima_designer / fatima123 (ูุดุฑูุน ุชุญุฏูุซ ุงููุธุงู)")
            print("   ๐ค khalid_analyst / khalid123 (ูุดุฑูุน ุชุฏุฑูุจ ุงูููุธููู)")
            print("   ๐ค mona_tester / mona123 (ุจุฏูู ูุดุฑูุน)")
            
            print("\n๐ ุงููุดุงุฑูุน:")
            print("   PRJ_001: ูุดุฑูุน ุชุทููุฑ ุงูุชุทุจูู")
            print("   PRJ_002: ูุดุฑูุน ุชุญุฏูุซ ุงููุธุงู")
            print("   PRJ_003: ูุดุฑูุน ุชุฏุฑูุจ ุงูููุธููู")
            print("   PRJ_004: ูุดุฑูุน ุฃุจุญุงุซ ุงูุณูู")
            print("   PRJ_005: ูุดุฑูุน ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ")
            
            print("\n๐ฆ ุนูุงุตุฑ ุงููุฎุฒูู:")
            print("   - ุฃุฌูุฒุฉ ููุจููุชุฑ ูููุญูุงุชูุง")
            print("   - ุฎูุงุฏู ููุนุฏุงุช ุงูุดุจูุฉ")
            print("   - ููุงุฏ ุชุฏุฑูุจูุฉ ูุชุนููููุฉ")
            print("   - ุทุงุจุนุงุช ููุณุชูุฒูุงุช ููุชุจูุฉ")
            
            print("\n๐ ููุจุฏุก:")
            print("   python main_with_auth.py")
            
        else:
            print("\nโ ูุดู ูู ุฅุนุงุฏุฉ ููููุฉ ุงูุดูุชุงุช")
    else:
        print("โ ุชู ุฅูุบุงุก ุงูุนูููุฉ")
    
    input("\nุงุถุบุท Enter ููุฎุฑูุฌ...")