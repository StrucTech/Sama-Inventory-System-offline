#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙƒØ±Ø±Ø©
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from sheets.manager import SheetsManager

class MockWorksheet:
    """Ù…Ø­Ø§ÙƒÙŠ ÙˆØ±Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±"""
    
    def __init__(self):
        # Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© - Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¹Ù†ØµØ±ØŒ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„ØªØµÙ†ÙŠÙØŒ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„ÙƒÙ…ÙŠØ©ØŒ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„ØªØ§Ø±ÙŠØ®
        self.data = [
            ["Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±", "Ø§Ù„ØªØµÙ†ÙŠÙ", "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©", "Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹", "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«"],  # Header
            ["Ø£Ø³Ù…Ù†Øª", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", "100", "Ù…Ø´Ø±ÙˆØ¹1", "2024-01-01"],
            ["Ø­Ø¯ÙŠØ¯", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", "50", "Ù…Ø´Ø±ÙˆØ¹1", "2024-01-02"],
            ["Ø£Ø³Ù…Ù†Øª", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", "75", "Ù…Ø´Ø±ÙˆØ¹2", "2024-01-03"],  # Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ± Ù„ÙƒÙ† Ù…Ø´Ø±ÙˆØ¹ Ù…Ø®ØªÙ„Ù
        ]
    
    def get_all_values(self):
        """Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        return self.data
    
    def update(self, range_name, values):
        """ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        print(f"ðŸ“ ØªØ­Ø¯ÙŠØ« {range_name} Ø¨Ø§Ù„Ù‚ÙŠÙ…: {values}")
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ØµÙ
        row_num = int(range_name.split(':')[0][1:])  # A2:E2 -> 2
        
        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if row_num <= len(self.data):
            self.data[row_num - 1] = values[0]
        else:
            # Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            self.data.append(values[0])
        
        print(f"âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«: {self.data[row_num - 1]}")

class MockSheetsManager(SheetsManager):
    """Ù…Ø­Ø§ÙƒÙŠ Ù…Ø¯ÙŠØ± Ø§Ù„Ø´ÙŠØªØ§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±"""
    
    def __init__(self):
        # Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ __init__ Ø§Ù„Ø£ØµÙ„ÙŠ
        self.worksheet = MockWorksheet()
        self.activity_log = None
    
    def _log_activity(self, action, item_name, new_value, old_value, details):
        """Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·"""
        print(f"ðŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·: {action} - {item_name} - {details}")

def test_quantity_merging():
    """Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª"""
    print("ðŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª...")
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø´ÙŠØªØ§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠ
    manager = MockSheetsManager()
    
    print("\nðŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:")
    for i, row in enumerate(manager.worksheet.data):
        print(f"  {i}: {row}")
    
    print("\nðŸ”¬ Ø§Ø®ØªØ¨Ø§Ø± 1: Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ© Ù„Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹")
    # Ø¥Ø¶Ø§ÙØ© 25 Ù…Ù† Ø§Ù„Ø£Ø³Ù…Ù†Øª Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ 1 (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØµØ¨Ø­ 100 + 25 = 125)
    result = manager.add_item("Ø£Ø³Ù…Ù†Øª", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", 25, "Ù…Ø´Ø±ÙˆØ¹1")
    print(f"Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©: {result}")
    
    print("\nðŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„:")
    for i, row in enumerate(manager.worksheet.data):
        print(f"  {i}: {row}")
    
    print("\nðŸ”¬ Ø§Ø®ØªØ¨Ø§Ø± 2: Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯")
    # Ø¥Ø¶Ø§ÙØ© Ø·ÙˆØ¨ Ø¬Ø¯ÙŠØ¯
    result = manager.add_item("Ø·ÙˆØ¨", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", 200, "Ù…Ø´Ø±ÙˆØ¹1")
    print(f"Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©: {result}")
    
    print("\nðŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ:")
    for i, row in enumerate(manager.worksheet.data):
        print(f"  {i}: {row}")
    
    print("\nðŸ”¬ Ø§Ø®ØªØ¨Ø§Ø± 3: Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ù…Ø´Ø±ÙˆØ¹ Ù…Ø®ØªÙ„Ù")
    # Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ù†Øª Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ 3 (ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯)
    result = manager.add_item("Ø£Ø³Ù…Ù†Øª", "Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡", 50, "Ù…Ø´Ø±ÙˆØ¹3")
    print(f"Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©: {result}")
    
    print("\nðŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:")
    for i, row in enumerate(manager.worksheet.data):
        print(f"  {i}: {row}")
    
    print("\nâœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!")

if __name__ == "__main__":
    test_quantity_merging()