#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ุฅุตูุงุญุงุช ูุงูุฐุฉ ุงูุชูุงุฑูุฑ ูุงูููุงุชุฑ
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

import tkinter as tk
from tkinter import ttk
from gui.reports_window import show_reports_window
from datetime import datetime, timedelta

class MockSheetsManager:
    """ูุญุงูู ูุฏูุฑ ุงูุดูุชุงุช ููุงุฎุชุจุงุฑ ูุน ุจูุงูุงุช ุฃูุซุฑ ุชููุนุงู"""
    
    def __init__(self):
        pass
    
    def get_all_items_raw(self):
        """ุฅุฑุฌุงุน ุจูุงูุงุช ุฎุงู ููุนูุงุตุฑ"""
        return [
            ["ุฃุณููุช", "ููุงุฏ ุจูุงุก", "100", "ูุดุฑูุน1", "2024-10-25 10:00:00"],
            ["ุญุฏูุฏ", "ููุงุฏ ุจูุงุก", "50", "ูุดุฑูุน1", "2024-10-26 11:00:00"],
            ["ุทูุจ", "ููุงุฏ ุจูุงุก", "200", "ูุดุฑูุน2", "2024-10-27 12:00:00"],
            ["ุฏูุงู ุฃุจูุถ", "ุชุดุทูุจุงุช", "30", "ูุดุฑูุน1", "2024-10-28 13:00:00"],
            ["ุจูุงุท", "ุชุดุทูุจุงุช", "75", "ูุดุฑูุน2", "2024-10-29 14:00:00"],
            ["ูุงุจู", "ููุฑุจุงุก", "120", "ูุดุฑูุน3", "2024-10-30 15:00:00"],
        ]
    
    def get_all_items(self):
        """ุฅุฑุฌุงุน ุจูุงูุงุช ููููุฉ ููุนูุงุตุฑ (ููุชูุงูู)"""
        raw_items = self.get_all_items_raw()
        return [{
            'item_name': item[0],
            'category': item[1], 
            'quantity': float(item[2]),
            'project_id': item[3],
            'last_updated': item[4]
        } for item in raw_items]
    
    def get_activity_log(self):
        """ุฅุฑุฌุงุน ุณุฌู ูุดุงุท ูููู ูุน ุนูููุงุช ุฅุฎุฑุงุฌ"""
        return [
            ["2024-10-25 10:00:00", "ุฅุถุงูุฉ", "ุฃุณููุช", "100", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 100 ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-26 11:00:00", "ุฅุถุงูุฉ", "ุญุฏูุฏ", "50", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 50 ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-26 15:00:00", "ุฅุฎุฑุงุฌ", "ุฃุณููุช", "20", "ุฃุญูุฏ ูุญูุฏ", "ุฅุฎุฑุงุฌ ุจุถุงุนุฉ - ุงููููุฉ ุงููุฎุฑุฌุฉ: 20, ุงููููุฉ ุงููุชุจููุฉ: 80 ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-27 12:00:00", "ุฅุถุงูุฉ", "ุทูุจ", "200", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 200 ูููุดุฑูุน ูุดุฑูุน2"],
            ["2024-10-27 16:00:00", "ุฅุฎุฑุงุฌ", "ุญุฏูุฏ", "15", "ุณุงุฑุฉ ุฃุญูุฏ", "ุฅุฎุฑุงุฌ ุจุถุงุนุฉ - ุงููููุฉ ุงููุฎุฑุฌุฉ: 15, ุงููููุฉ ุงููุชุจููุฉ: 35 ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-28 13:00:00", "ุฅุถุงูุฉ", "ุฏูุงู ุฃุจูุถ", "30", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 30 ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-28 17:00:00", "ุฅุฎุฑุงุฌ", "ุทูุจ", "50", "ูุญูุฏ ุนูู", "ุฅุฎุฑุงุฌ ุจุถุงุนุฉ - ุงููููุฉ ุงููุฎุฑุฌุฉ: 50, ุงููููุฉ ุงููุชุจููุฉ: 150 ูููุดุฑูุน ูุดุฑูุน2"],
            ["2024-10-29 14:00:00", "ุฅุถุงูุฉ", "ุจูุงุท", "75", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 75 ูููุดุฑูุน ูุดุฑูุน2"],
            ["2024-10-29 18:00:00", "ุชุญุฏูุซ", "ุฃุณููุช", "120", "80", "ุชุญุฏูุซ ูููุฉ ุงูุนูุตุฑ ูู 80 ุฅูู 120 (ุฅุถุงูุฉ 40) ูููุดุฑูุน ูุดุฑูุน1"],
            ["2024-10-30 15:00:00", "ุฅุถุงูุฉ", "ูุงุจู", "120", "", "ุฅุถุงูุฉ ุนูุตุฑ ุฌุฏูุฏ ุจูููุฉ 120 ูููุดุฑูุน ูุดุฑูุน3"],
            ["2024-10-30 19:00:00", "ุฅุฎุฑุงุฌ", "ุฏูุงู ุฃุจูุถ", "10", "ูุงุทูุฉ ุญุณู", "ุฅุฎุฑุงุฌ ุจุถุงุนุฉ - ุงููููุฉ ุงููุฎุฑุฌุฉ: 10, ุงููููุฉ ุงููุชุจููุฉ: 20 ูููุดุฑูุน ูุดุฑูุน1"],
        ]

class MockUser:
    """ูุญุงูู ุจูุงูุงุช ุงููุณุชุฎุฏู"""
    
    def __init__(self):
        self.user_data = {
            'username': 'test_user',
            'user_type': 'admin',
            'project_id': 'ูุดุฑูุน1'
        }
    
    def get(self, key, default=None):
        return self.user_data.get(key, default)

def test_fixed_reports_window():
    """ุงุฎุชุจุงุฑ ูุงูุฐุฉ ุงูุชูุงุฑูุฑ ุงููุตุญุญุฉ"""
    print("๐ ุจุฏุก ุงุฎุชุจุงุฑ ูุงูุฐุฉ ุงูุชูุงุฑูุฑ ุงููุตุญุญุฉ...")
    
    # ุฅูุดุงุก ุงููุงูุฐุฉ ุงูุฑุฆูุณูุฉ
    root = tk.Tk()
    root.title("ุงุฎุชุจุงุฑ ุงูุชูุงุฑูุฑ ุงููุตุญุญุฉ")
    root.geometry("400x300")
    
    # ูุฏูุฑ ุงูุดูุชุงุช ุงููููู
    mock_manager = MockSheetsManager()
    mock_user = MockUser()
    
    # ุฒุฑ ููุชุญ ูุงูุฐุฉ ุงูุชูุงุฑูุฑ
    def open_reports():
        print("๐ ูุชุญ ูุงูุฐุฉ ุงูุชูุงุฑูุฑ...")
        try:
            show_reports_window(root, mock_manager, mock_user)
        except Exception as e:
            print(f"โ ุฎุทุฃ: {e}")
            import traceback
            traceback.print_exc()
    
    # ุฅูุดุงุก ูุงุฌูุฉ ุงูุงุฎุชุจุงุฑ
    main_frame = ttk.Frame(root, padding="20")
    main_frame.pack(fill=tk.BOTH, expand=True)
    
    title_label = ttk.Label(main_frame, text="ุงุฎุชุจุงุฑ ุงูุชูุงุฑูุฑ ุงููุตุญุญุฉ", 
                           font=("Arial", 14, "bold"))
    title_label.pack(pady=(0, 20))
    
    open_btn = ttk.Button(main_frame, text="ูุชุญ ูุงูุฐุฉ ุงูุชูุงุฑูุฑ ูุงูุชุญููู", 
                         command=open_reports)
    open_btn.pack(pady=10)
    
    info_text = """ุงูุจูุงูุงุช ุงูููููุฉ ุชุชุถูู:
โข 6 ุนูุงุตุฑ ูู 3 ูุดุงุฑูุน ูุฎุชููุฉ
โข 11 ุนูููุฉ (ุฅุถุงูุฉุ ุฅุฎุฑุงุฌุ ุชุญุฏูุซ)
โข ุนูููุงุช ุฅุฎุฑุงุฌ ูุชุนุฏุฏุฉ ูุงุฎุชุจุงุฑ ุงูููุงุชุฑ
โข ุชูุงุฑูุฎ ูุชููุนุฉ ูุงุฎุชุจุงุฑ ููุชุฑ ุงูุชุงุฑูุฎ

ุงุฎุชุจุฑ:
โ ููุชุฑ ุงูุนูุงุตุฑ (ูุซู: ุฃุณููุช)
โ ููุชุฑ ุงููุดุงุฑูุน (ูุซู: ูุดุฑูุน1)
โ ููุชุฑ ุงูุชุตูููุงุช (ูุซู: ููุงุฏ ุจูุงุก)
โ ููุชุฑ ุงูุชูุงุฑูุฎ (ูู 2024-10-26 ุฅูู 2024-10-28)
โ ูุณุญ ุงูููุงุชุฑ"""
    
    info_label = ttk.Label(main_frame, text=info_text, justify=tk.LEFT)
    info_label.pack(pady=10)
    
    close_btn = ttk.Button(main_frame, text="ุฅุบูุงู", command=root.quit)
    close_btn.pack(pady=10)
    
    print("โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ!")
    root.mainloop()

if __name__ == "__main__":
    test_fixed_reports_window()