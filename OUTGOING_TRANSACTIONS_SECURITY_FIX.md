# ุฅุตูุงุญ ุซุบุฑุฉ ุนูููุงุช ุงูุฎุฑูุฌ: ููุน ุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ

## ุงููุดููุฉ ุงูููุชุดูุฉ ุงูุซุงููุฉ
**ุซุบุฑุฉ ุฅุถุงููุฉ:** ูุงู ูู ุงููููู ุชุนุฏูู ูููุฉ ุงูุฎุฑูุฌ ุฅูู ูููุฉ ุฃูุจุฑ ูู ุงููุฎุฒูู ุงููุชุงุญุ ููุง ูุคุฏู ุฃูุถุงู ุฅูู ูุฎุฒูู ุณุงูุจ.

### ูุซุงู ุนูู ุงููุดููุฉ:
```
1. ุฏุฎูู 300 ูุญุฏุฉ
2. ุฎุฑูุฌ 100 ูุญุฏุฉ โ ุงููุฎุฒูู = 200
3. ุชุนุฏูู ุงูุฎุฑูุฌ ูู 100 ุฅูู 3000 ูุญุฏุฉ
   โ ุงููุฎุฒูู ูุตุจุญ = 300 - 3000 = -2700 โ
```

## ุงูุญู ุงูููุทุจู

### 1. ุฏุงูุฉ ุฌุฏูุฏุฉ ูุญุณุงุจ ุงููุฎุฒูู ุงููุชุงุญ
```python
def get_available_stock_excluding_transaction(self, item_name, exclude_transaction_id):
    """ุญุณุงุจ ุงููุฎุฒูู ุงููุชุงุญ ุจุฏูู ุงุญุชุณุงุจ ูุนุงููุฉ ูุญุฏุฏุฉ"""
```

**ุงููุธุงุฆู:**
- ุชุญุณุจ ุงููุฎุฒูู ุงููุงูู ููุนูุตุฑ
- ุชุณุชุจุนุฏ ุงููุนุงููุฉ ุงูุญุงููุฉ ุงูุชู ูุชู ุชุนุฏูููุง ูู ุงูุญุณุงุจ
- ุชุนุทู ุงููุฎุฒูู ุงููุนูู ุงููุชุงุญ ููุฎุฑูุฌ
- ุชุฏุนู ุงููููุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ (ูุน ูุจุฏูู ุฃุฑูุงู ุงููุนุงููุงุช)

### 2. ุชุญุฏูุซ ููุทู ุงูุชุญูู ูู ุนูููุงุช ุงูุฎุฑูุฌ

#### ุฃ) ูู ุฏุงูุฉ save_modification:
```python
# ุงูุชุญูู ูู ุนูููุงุช ุงูุฎุฑูุฌ ูููุน ุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ
if transaction['ููุน_ุงูุนูููุฉ'] in ['ุฎุฑูุฌ', 'ุชุนุฏูู ููุต']:
    # ุญุณุงุจ ุงููุฎุฒูู ุงููุชุงุญ ุจุฏูู ุงุญุชุณุงุจ ูุฐู ุงููุนุงููุฉ
    transaction_id = transaction.get('ุฑูู_ุงููุนุงููุฉ', None)
    available_stock = self.get_available_stock_excluding_transaction(
        transaction['ุงุณู_ุงูุนูุตุฑ'], 
        transaction_id
    )
    
    # ุงูุชุญูู ูู ุฃู ุงููููุฉ ุงูุฌุฏูุฏุฉ ูุง ุชุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ
    if new_qty > available_stock:
        QMessageBox.warning(
            self, "ุชุญุฐูุฑ", 
            f"ูุง ูููู ุชุนุฏูู ูุฐู ุงููุนุงููุฉ ุฅูู {new_qty} ูุญุฏุฉ.\n\n"
            f"ุงููุฎุฒูู ุงููุชุงุญ: {available_stock} ูุญุฏุฉ\n"
            f"ุงูุญุฏ ุงูุฃูุตู ููุฎุฑูุฌ: {available_stock} ูุญุฏุฉ\n\n"
            f"ุชุนุฏูู ูุฐู ุงููุนุงููุฉ ูุฏ ูุคุฏู ุฅูู ูุฎุฒูู ุณุงูุจ."
        )
        return
```

#### ุจ) ูู ุฏุงูุฉ calculate_difference (ุชุญุฐูุฑ ููุฑู):
```python
# ุงูุชุญูู ูู ุนูููุงุช ุงูุฎุฑูุฌ ูุนุฑุถ ุชุญุฐูุฑ ุฅุฐุง ูุฒู
if transaction['ููุน_ุงูุนูููุฉ'] in ['ุฎุฑูุฌ', 'ุชุนุฏูู ููุต']:
    available_stock = self.get_available_stock_excluding_transaction(
        transaction['ุงุณู_ุงูุนูุตุฑ'], 
        transaction_id
    )
    
    if new_qty > available_stock:
        self.difference_label.setText(f"{difference} - ุชุญุฐูุฑ: ูุชุฌุงูุฒ ุงููุฎุฒูู ({available_stock})")
        self.difference_label.setStyleSheet("color: red; font-weight: bold; background-color: #ffeeee;")
        return
```

### 3. ุชุญุฏูุซ ุฑุณุงูุฉ ุงููุนูููุงุช
```
"ููููู ุชุนุฏูู ุงููููุงุช ุงููุฏุฎูุฉ ุฎูุงู ุขุฎุฑ 24 ุณุงุนุฉ ููุท
ูููุฏ ุงูุญูุงูุฉ ูู ุงููุฎุฒูู ุงูุณุงูุจ:
โข ูุง ูููู ุชุนุฏูู ูุนุงููุงุช ุงูุฏุฎูู ุฅุฐุง ุชูุช ุนูููุงุช ุฅุฎุฑุงุฌ ุจุนุฏูุง
โข ูุง ูููู ุฒูุงุฏุฉ ูููุฉ ุงูุฎุฑูุฌ ูุชุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ"
```

## ููุทู ุงูุญูุงูุฉ ุงูุดุงูู

### ุงูููุงุนุฏ ุงูููุทุจูุฉ ุงูุขู:

| ููุน ุงููุนุงููุฉ | ุดุฑูุท ุงูุชุนุฏูู | ุงูุญูุงูุฉ |
|--------------|---------------|----------|
| **ุฏุฎูู** | โ ุฅุฐุง ูู ุชูู ููุงู ุนูููุงุช ุฅุฎุฑุงุฌ ุจุนุฏูุง | ููุน ุชูููู ุงูุฏุฎูู ุฅุฐุง ุชู ุงูุฎุฑูุฌ ูุงุญูุงู |
| **ุฎุฑูุฌ** | โ ุฅุฐุง ูู ุชุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ | ููุน ุฒูุงุฏุฉ ุงูุฎุฑูุฌ ุนู ุงููุชุงุญ |
| **ุชุนุฏูู ุฒูุงุฏุฉ** | โ ุฅุฐุง ูู ุชูู ููุงู ุนูููุงุช ุฅุฎุฑุงุฌ ุจุนุฏูุง | ููุน ุชูููู ุงูุฒูุงุฏุฉ ุฅุฐุง ุชู ุงูุฎุฑูุฌ ูุงุญูุงู |
| **ุชุนุฏูู ููุต** | โ ุฅุฐุง ูู ุชุชุฌุงูุฒ ุงููุฎุฒูู ุงููุชุงุญ | ููุน ุฒูุงุฏุฉ ุงูููุต ุนู ุงููุชุงุญ |

### 4. ุงูุญูุงูุฉ ุงููุฒุฏูุฌุฉ

#### ุฃ) ุชุญุฐูุฑ ููุฑู ูู ุงููุงุฌูุฉ:
- ุนูุฏ ุชุบููุฑ ุงููููุฉ ูุจุงุดุฑุฉ
- ุนุฑุถ ุชุญุฐูุฑ ูููู ูู ููุทูุฉ ุงููุฑู
- ุชูุจูู ุงููุณุชุฎุฏู ูุจู ุงููุญุงููุฉ

#### ุจ) ููุน ุนูู ูุณุชูู ุงูุจูุงูุงุช:
- ุงูุชุญูู ุงูููุงุฆู ูุจู ุงูุญูุธ
- ุฑุณุงูุฉ ูุงุถุญุฉ ุชุดุฑุญ ุงูุณุจุจ
- ููุน ุญูุธ ุงูุจูุงูุงุช ุงูุฎุทูุฑุฉ

## ุงูุณููุงุฑูููุงุช ุงููุญููุฉ

### 1. ุงูุณููุงุฑูู ุงูุฃูู (ูุญูู):
```
10:00 - ุฏุฎูู 300 ูุญุฏุฉ
11:00 - ุฎุฑูุฌ 100 ูุญุฏุฉ (ุงููุฎุฒูู = 200)
12:00 - ูุญุงููุฉ ุชุนุฏูู ุงูุฎุฑูุฌ ุฅูู 500 โ โ ูุฑููุถ
ุงูุฑุณุงูุฉ: "ุงููุฎุฒูู ุงููุชุงุญ: 200 ูุญุฏุฉ"
```

### 2. ุงูุณููุงุฑูู ุงูุซุงูู (ูุญูู):
```
10:00 - ุฏุฎูู 100 ูุญุฏุฉ
11:00 - ุฏุฎูู 800 ูุญุฏุฉ
12:00 - ุฎุฑูุฌ 900 ูุญุฏุฉ
13:00 - ูุญุงููุฉ ุชุนุฏูู ุงูุฏุฎูู ุงูุฃูู โ โ ูุฑููุถ
ุงูุฑุณุงูุฉ: "ุชูุฌุฏ ุนูููุงุช ุฅุฎุฑุงุฌ ุจุนุฏูุง"
```

### 3. ุงูุณููุงุฑูู ุงููุณููุญ:
```
10:00 - ุฏุฎูู 300 ูุญุฏุฉ
11:00 - ุฎุฑูุฌ 100 ูุญุฏุฉ (ุงููุฎุฒูู = 200)
12:00 - ุชุนุฏูู ุงูุฎุฑูุฌ ูู 100 ุฅูู 150 โ โ ูุณููุญ
(ุงููุชุงุญ = 200, ุงููุทููุจ = 150)
```

## ุงูููุฒุงุช ุงูุฅุถุงููุฉ

### 1. ุงูุชูุงูู ูุน ุงููููุงุช ุงููุฏููุฉ:
- ูุนูู ูุน ุงููููุงุช ุงูุชู ูุง ุชุญุชูู ุนูู ุฃุฑูุงู ูุนุงููุงุช
- ุขููุฉ ุงุญุชูุงุทูุฉ ููุญุณุงุจ

### 2. ุฏูุฉ ุงูุญุณุงุจุงุช:
- ุงุณุชุจุนุงุฏ ุงููุนุงููุฉ ุงูุญุงููุฉ ูู ุญุณุงุจ ุงููุฎุฒูู
- ุญุณุงุจ ุฏููู ูููุฎุฒูู ุงููุนูู ุงููุชุงุญ

### 3. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงููุญุณูุฉ:
- ุชุญุฐูุฑุงุช ููุฑูุฉ ุฃุซูุงุก ุงูุชุนุฏูู
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุตูุฉ
- ุฃููุงู ุชุญุฐูุฑูุฉ ููููู ุงูุฎุทูุฑุฉ

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุงููุธุงู ุงูุขู ูุญูู ุจุงููุงูู ูู **ุฌููุน** ุงูุณููุงุฑูููุงุช ุงูุชู ูุฏ ุชุคุฏู ุฅูู ูุฎุฒูู ุณุงูุจ:

โ **ุญูุงูุฉ ูุนุงููุงุช ุงูุฏุฎูู** - ููุน ุงูุชูููู ุฅุฐุง ุชู ุฎุฑูุฌ ูุงุญูุงู  
โ **ุญูุงูุฉ ูุนุงููุงุช ุงูุฎุฑูุฌ** - ููุน ุงูุชุฌุงูุฒ ูููุฎุฒูู ุงููุชุงุญ  
โ **ุญูุงูุฉ ูุนุงููุงุช ุงูุชุนุฏูู** - ุชุทุจูู ููุณ ุงูููุงุนุฏ ุญุณุจ ุงูููุน  
โ **ุชุญุฐูุฑุงุช ููุฑูุฉ** - ูููุณุชุฎุฏู ุฃุซูุงุก ุงูุชุนุฏูู  
โ **ููุน ููุงุฆู** - ุนูู ูุณุชูู ุญูุธ ุงูุจูุงูุงุช  

ุงููุธุงู ุฃุตุจุญ **ุขููุงู ุชูุงูุงู** ุถุฏ ุงููุฎุฒูู ุงูุณุงูุจ! ๐ก๏ธ