#!/usr/bin/env python3
"""
ุณูุฑูุจุช ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ ุชููุงุฆูุงู
"""

import json
import os
from datetime import datetime

def update_version_to_1_2_3():
    """ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ ุฅูู 1.2.3"""
    
    print("๐ ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ ุฅูู 1.2.3...")
    
    # 1. ุชุญุฏูุซ update_info.json
    update_info_path = "update_info.json"
    
    try:
        # ูุฑุงุกุฉ ุงูููู ุงูุญุงูู
        with open(update_info_path, 'r', encoding='utf-8') as f:
            update_info = json.load(f)
        
        # ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ
        old_version = update_info.get('current_version', 'ุบูุฑ ูุญุฏุฏ')
        update_info['current_version'] = '1.2.3'
        update_info['last_update'] = datetime.now().isoformat()
        
        # ูุชุงุจุฉ ุงูููู ุงููุญุฏุซ
        with open(update_info_path, 'w', encoding='utf-8') as f:
            json.dump(update_info, f, ensure_ascii=False, indent=2)
        
        print(f"โ ุชู ุชุญุฏูุซ {update_info_path}: {old_version} โ 1.2.3")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุชุญุฏูุซ {update_info_path}: {e}")
    
    # 2. ุงูุจุญุซ ุนู VERSION ูู main_with_auth.py ูุชุญุฏูุซู
    main_file_path = "main_with_auth.py"
    
    try:
        # ูุฑุงุกุฉ ุงูููู
        with open(main_file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # ุงูุจุญุซ ุนู ุงูุณุทุฑ ุงูุฐู ูุญุชูู ุนูู VERSION
        lines = content.split('\n')
        updated_lines = []
        version_updated = False
        
        for line in lines:
            if 'VERSION = ' in line and not line.strip().startswith('#'):
                # ุงุณุชุฎุฑุงุฌ ุงูุฅุตุฏุงุฑ ุงููุฏูู
                old_line = line
                # ุชุญุฏูุซ ุงูุณุทุฑ
                new_line = 'VERSION = "1.2.3"'
                updated_lines.append(new_line)
                version_updated = True
                print(f"๐ ุชุญุฏูุซ ุงูุณุทุฑ: {old_line.strip()} โ {new_line}")
            else:
                updated_lines.append(line)
        
        if version_updated:
            # ูุชุงุจุฉ ุงูููู ุงููุญุฏุซ
            with open(main_file_path, 'w', encoding='utf-8') as f:
                f.write('\n'.join(updated_lines))
            print(f"โ ุชู ุชุญุฏูุซ VERSION ูู {main_file_path}")
        else:
            print(f"โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู VERSION ูู {main_file_path}")
            
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุชุญุฏูุซ {main_file_path}: {e}")
    
    # 3. ุฅูุดุงุก ููู changelog
    changelog_content = """# ๐ ุณุฌู ุงูุชุญุฏูุซุงุช - ุงูุฅุตุฏุงุฑ 1.2.3

## ๐ ุชุงุฑูุฎ ุงูุฅุทูุงู: 17 ููููุจุฑ 2025

### โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:
- ๐ **ูุธุงู ูููุฏ ุงูููุงุชุฑ ูููุณุชุฎุฏููู ุงูุนุงุฏููู**
  - ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูุฑูู ููุท ุจูุงูุงุช ูุดุงุฑูุนูู
  - ููุงุชุฑ ุงููุณุชุฎุฏู ูุงููุดุฑูุน ูููุฏุฉ ููุญุฏุฏุฉ ูุณุจูุงู
  - ููุงุชุฑ ุงูุชุตููู ูุงูุนูุตุฑ ูุงุจูุฉ ููุชุนุฏูู

- ๐ฅ **ูุธุงู ุตูุงุญูุงุช ูุชูุฏู**
  - ุชูููุฒ ุจูู ุงููุฏูุฑ ูุงููุณุชุฎุฏู ุงูุนุงุฏู
  - ุฅุฏุงุฑุฉ ุฌูุณุงุช ุงููุณุชุฎุฏููู
  - ุชุญูู ุฏููู ูู ุงููุตูู ููุจูุงูุงุช

- ๐จ **ุชุญุณููุงุช ุงููุงุฌูุฉ**
  - ูุคุดุฑุงุช ุจุตุฑูุฉ ููููุงุชุฑ ุงููููุฏุฉ
  - ุฑุณุงุฆู ุชูุถูุญูุฉ ูุฃุณุจุงุจ ุงููููุฏ
  - ุฃููุงู ูููุฒุฉ ููุชุญูู ูู ุงูุญุงูุฉ

### ๐๏ธ ุงูุชุญุณููุงุช:
- โก **ุฃุฏุงุก ูุญุณู ููููุงุชุฑ**
  - ููุทู ููุชุฑุฉ ูุญุณู ูุฃุณุฑุน
  - ุชุดุฎูุต ุฃูุถู ููุดุงูู ุงูุจูุงูุงุช
  - ุฑุณุงุฆู ุฎุทุฃ ุฃูุซุฑ ูุถูุญุงู

- ๐ **ูุนุงูุฌุฉ ุงูุจูุงูุงุช**
  - ููุชุฑุฉ ุฏูููุฉ ุจุฏูู ูุณุงูุงุช ุฅุถุงููุฉ
  - ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ุงููุงุฑุบุฉ
  - ุชุญุณูู ุนุฑุถ ุงููุชุงุฆุฌ

### ๐ ุงูุฅุตูุงุญุงุช:
- โ **ูุดููุฉ "ุงูููุงุชุฑ ูุง ุชุคุซุฑ ุนูู ุงูุจูุงูุงุช"**
  - ุฅุตูุงุญ ุฑุจุท ุฃุญุฏุงุซ ุงูููุงุชุฑ
  - ุชุญุณูู ููุทู ุชุทุจูู ุงูููุงุชุฑ
  - ุถูุงู ุงูุชุญุฏูุซ ุงูููุฑู ููุนุฑุถ

- ๐ง **ุฅุตูุงุญุงุช ุฅุถุงููุฉ**
  - ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
  - ุชุญุณูู ุงุณุชูุฑุงุฑ ุงููุธุงู
  - ุฅุตูุงุญ ูุดุงูู ุงููุงุฌูุฉ

### ๐ ูููุทูุฑูู:
- ๐งช **ุฃุฏูุงุช ุงุฎุชุจุงุฑ ุฌุฏูุฏุฉ**
  - ูููุงุช ุงุฎุชุจุงุฑ ุดุงููุฉ ููููุงุชุฑ
  - ุฃุฏูุงุช ุชุดุฎูุต ูุชูุฏูุฉ
  - ููุงุฐุฌ ุงุฎุชุจุงุฑ ูููุณุชุฎุฏููู ุงููุฎุชูููู

### ๐ ุงูุชุญุฏูุซ ุงูุชููุงุฆู:
- ุงููุธุงู ูุชุญูู ุชููุงุฆูุงู ูู ุงูุชุญุฏูุซุงุช ูู 24 ุณุงุนุฉ
- ุฑุณุงูุฉ ุชูุจูู ุนูุฏ ุชููุฑ ุฅุตุฏุงุฑ ุฌุฏูุฏ
- ุชุญุฏูุซ ุณูุณ ุจุฏูู ููุฏุงู ุงูุจูุงูุงุช

---

## ๐ ููููุฉ ุงูุญุตูู ุนูู ุงูุชุญุฏูุซ:

### ูููุณุชุฎุฏููู ุงูุญุงูููู:
1. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:** ุงูุชุธุฑ ุฑุณุงูุฉ ุงูุชุญุฏูุซ (ุฎูุงู 24 ุณุงุนุฉ)
2. **ุงูุชุญุฏูุซ ุงููุฏูู:** ุญููู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู GitHub
3. **ุงูุชุญูู ูู ุงูุฅุตุฏุงุฑ:** ูุงุฆูุฉ ูุณุงุนุฏุฉ > ุญูู ุงูุจุฑูุงูุฌ

### ูููุณุชุฎุฏููู ุงูุฌุฏุฏ:
1. ุญููู ุขุฎุฑ ุฅุตุฏุงุฑ ูู: https://github.com/StrucTech/Sama-Inventory-System/releases
2. ุงุชุจุน ุฏููู ุงูุชุซุจูุช ูู README.md
3. ุฃุนุฏ ุฅุนุฏุงุฏ ุงุชุตุงู Google Sheets

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ:

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ูุน ูุฐุง ุงูุชุญุฏูุซ:
- ๐ง ุชูุงุตู ูุนูุง ุนุจุฑ GitHub Issues
- ๐ ุงูุฑุฃ ุฏููู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
- ๐ ุงุณุชุฎุฏู ุฃุฏุงุฉ ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ

---

**ุชู ุจูุงุก ูุฐุง ุงูุฅุตุฏุงุฑ ุจู โค๏ธ ูู ูุฑูู StrucTech**
"""

    try:
        with open("CHANGELOG_v1.2.3.md", 'w', encoding='utf-8') as f:
            f.write(changelog_content)
        print("โ ุชู ุฅูุดุงุก ููู CHANGELOG_v1.2.3.md")
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅูุดุงุก ููู ุงูุชุบููุฑุงุช: {e}")
    
    print("\n๐ ุชู ุงูุงูุชูุงุก ูู ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ ุฅูู 1.2.3!")
    print("\n๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ:")
    print("1. ุงุฎุชุจุงุฑ ุงูุจุฑูุงูุฌ ุงููุญุฏุซ")
    print("2. ุฅูุดุงุก Release ุนูู GitHub") 
    print("3. ุฑูุน ุงููููุงุช ุงููุญุฏุซุฉ")
    print("4. ูุดุฑ ููุงุญุธุงุช ุงูุฅุตุฏุงุฑ")

def test_auto_update_system():
    """ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู"""
    
    print("\n๐งช ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู...")
    
    try:
        from auto_updater import AutoUpdater
        
        # ุฅูุดุงุก ูุซูู ูููุญุฏุซ
        updater = AutoUpdater()
        
        print(f"๐ ุงูุฅุตุฏุงุฑ ุงูุญุงูู: {updater.current_version}")
        print(f"๐ ุฑุงุจุท ุงูุชุญุฏูุซ: {updater.update_url}")
        print(f"โฐ ูุชุฑุฉ ุงููุญุต: {updater.check_interval} ุณุงุนุฉ")
        print(f"๐ ุงูุชุญุฏูุซ ุงูุชููุงุฆู: {'ููุนูู' if updater.auto_update else 'ูุนุทูู'}")
        
        # ูุญุต ุถุฑูุฑุฉ ุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช
        should_check = updater.should_check_for_updates()
        print(f"๐ ูุญุชุงุฌ ูุญุต ุชุญุฏูุซุงุช: {'ูุนู' if should_check else 'ูุง'}")
        
        print("โ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุฌุงูุฒ!")
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุญุฏูุซ: {e}")

if __name__ == "__main__":
    print("๐ ุณูุฑูุจุช ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ")
    print("=" * 50)
    
    # ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ
    update_version_to_1_2_3()
    
    # ุงุฎุชุจุงุฑ ูุธุงู ุงูุชุญุฏูุซ ุงูุชููุงุฆู
    test_auto_update_system()
    
    print("\n" + "=" * 50)
    print("โจ ูุจุฑูู! ุงูุฅุตุฏุงุฑ 1.2.3 ุฌุงูุฒ ููุฅุทูุงู")