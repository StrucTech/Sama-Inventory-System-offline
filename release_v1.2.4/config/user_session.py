"""
Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡
"""

class UserSession:
    """ÙƒÙ„Ø§Ø³ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ"""
    
    def __init__(self):
        self.username = None
        self.project_number = None
        self.is_admin = False
        self.is_logged_in = False
        self.login_time = None
    
    def login(self, username, project_number, is_admin=False):
        """ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        from datetime import datetime
        
        self.username = username
        self.project_number = project_number
        self.is_admin = is_admin
        self.is_logged_in = True
        self.login_time = datetime.now()
        
        print(f"âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {username}")
        print(f"   Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: {project_number}")
        print(f"   Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {'Ù…Ø¯ÙŠØ±' if is_admin else 'Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ'}")
    
    def logout(self):
        """ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        print(f"ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {self.username}")
        
        self.username = None
        self.project_number = None
        self.is_admin = False
        self.is_logged_in = False
        self.login_time = None
    
    def has_admin_access(self):
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±"""
        return self.is_logged_in and self.is_admin
    
    def can_access_project(self, project_number):
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹"""
        if not self.is_logged_in:
            return False
        
        # Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
        if self.is_admin:
            return True
        
        # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ÙˆØµÙˆÙ„ ÙÙ‚Ø· Ù„Ù…Ø´Ø±ÙˆØ¹Ù‡
        return str(self.project_number) == str(project_number)
    
    def can_access_user_data(self, username):
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        if not self.is_logged_in:
            return False
        
        # Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        if self.is_admin:
            return True
        
        # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ÙˆØµÙˆÙ„ ÙÙ‚Ø· Ù„Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
        return self.username == username
    
    def get_accessible_projects(self):
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…"""
        if not self.is_logged_in:
            return []
        
        if self.is_admin:
            # Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ±Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
            return ['Ø§Ù„ÙƒÙ„']  # Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        else:
            # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙŠØ±Ù‰ Ù…Ø´Ø±ÙˆØ¹Ù‡ ÙÙ‚Ø·
            return [str(self.project_number)]
    
    def get_accessible_users(self):
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­Ø©"""
        if not self.is_logged_in:
            return []
        
        if self.is_admin:
            # Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ±Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
            return ['Ø§Ù„ÙƒÙ„']  # Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        else:
            # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙŠØ±Ù‰ Ù†ÙØ³Ù‡ ÙÙ‚Ø·
            return [self.username]
    
    def __str__(self):
        """ØªÙ…Ø«ÙŠÙ„ Ù†ØµÙŠ Ù„Ù„Ø¬Ù„Ø³Ø©"""
        if not self.is_logged_in:
            return "ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„"
        
        return f"{self.username} - Ù…Ø´Ø±ÙˆØ¹ {self.project_number} ({'Ù…Ø¯ÙŠØ±' if self.is_admin else 'Ù…Ø³ØªØ®Ø¯Ù…'})"

# Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
current_session = UserSession()